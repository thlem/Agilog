"use strict";var agilogClient=angular.module("agilogClient",["ngResource","ngRoute","ngStorage"]);agilogClient.config(["$routeProvider","$httpProvider",function(r,e){r.when("/",{templateUrl:"partials/accueil.html","public":!0}).when("/login",{templateUrl:"partials/loginForm.html",controller:"AuthenticationLoginClientController","public":!0}).when("/register",{templateUrl:"partials/registerForm.html",controller:"AuthenticationRegisterClientController","public":!0}).when("/account",{templateUrl:"partials/account.html",controller:"AccountClientController"}).otherwise({redirectTo:"/"}),e.interceptors.push(["$q","$location","$localStorage","$rootScope","NotificationClientService",function(r,e,o,s,t){return{request:function(r){return r.headers=r.headers||{},o.user&&(r.headers.Authorization="Bearer "+o.user.token),r},responseError:function(i){var n=r.defer();switch(i.status){case 401:return delete o.user,delete s.root.user,t.addToErrorMessages(i.data.message),console.log(i),e.url("/"),r.reject(i);case 403:return t.addToErrorMessages(i.data.message),r.reject(i);default:return n.resolve(i),n.promise}}}}])}]),agilogClient.run(["$rootScope","$localStorage",function(r,e){r.root={},r.root.loading=null,r.root.loadingQueue=0,r.root.pageTitle="Accueil",e.user&&(r.root.user=e.user)}]),agilogClient.controller("AccountClientController",["$scope","$rootScope",function(r,e){e.root.pageTitle="Gestion de votre compte utilisateur",r.user=e.root.user}]),agilogClient.directive("usrAccountLoginDir",["NotificationClientService","AccountClientService","AuthenticationClientService","$location","$rootScope",function(r,e,o,s,t){return function(s,i){i.on("submit",function(){console.log(s.user),t.startLoading();var i=!0;if(void 0!==s.user.usrPassword&&""!==s.user.usrPassword&&void 0!==s.user.usrPasswordConfirm&&s.user.usrPassword!==s.user.usrPasswordConfirm&&(i=!1,$(this).find("#usrPassword").focus(),r.addToErrorMessages("Les mots de passe saisis ne sont pas identiques")),i){var n={usrLogin:s.user.usrLogin,usrPassword:s.user.usrPassword};e.submitAccountLoginInfoForm(n,function(e,s){s?(o.addOrUpdateUserInLocalStorage(s),r.addToSuccessMessages(e)):r.addToErrorMessages(e),t.endLoading()})}else t.endLoading()})}}]),agilogClient.directive("usrAccountPersonalDir",["NotificationClientService","AccountClientService","AuthenticationClientService","$location","$rootScope",function(r,e,o,s,t){return function(s,i){i.on("submit",function(){if($(".inputError").removeClass("inputError"),t.startLoading(),!s.userAccountPersonalInfo.$valid&&s.userAccountPersonalInfo.usrMail.$error){var i=$(this).find("#usrMail");""!==s.user.usrMail&&(i.addClass("inputError"),i.focus()),t.endLoading()}else{var n={usrFirstName:s.user.usrFirstName,usrLastName:s.user.usrLastName,usrMail:s.user.usrMail};e.submitAccountPersonalInfoForm(n,function(e,s){s?(o.addOrUpdateUserInLocalStorage(s),r.addToSuccessMessages(e)):r.addToErrorMessages(e),t.endLoading()})}})}}]),agilogClient.service("AccountClientService",["$localStorage","$rootScope","$http",function(r,e,o){this.submitAccountLoginInfoForm=function(r,e){o.post("/account/update/logininfo",{usrLogin:r.usrLogin,usrPassword:r.usrPassword}).then(function(r){e(r.data.message,r.data.user)})},this.submitAccountPersonalInfoForm=function(r,e){o.post("/account/update/personalinfo",{usrFirstName:r.usrFirstName,usrLastName:r.usrLastName,usrMail:r.usrMail}).then(function(r){e(r.data.message,r.data.user)})}}]),agilogClient.controller("AuthenticationRegisterClientController",["$scope","$location","$rootScope","AuthenticationClientService",function(r,e,o,s){r.user={}}]),agilogClient.controller("AuthenticationLoginClientController",["$scope","$location","$rootScope","AuthenticationClientService",function(r,e,o,s){r.user={}}]),agilogClient.controller("AuthenticationLogoutClientController",["$scope","$location","$rootScope","AuthenticationClientService","NotificationClientService",function(r,e,o,s,t){r.logout=function(){o.startLoading(),s.logout().then(function(r){t.addToSuccessMessages(r.data.message),s.removeUserFromLocalStorage(),o.endLoading(),e.url("/")})}}]),agilogClient.directive("registerFormDir",["NotificationClientService","AuthenticationClientService","$location","$rootScope",function(r,e,o,s){return function(t,i){s.root.user&&o.url("/");var n=$(i[0]),a=$(n).find("#usrLogin");if(a.val()){var u=$(n).find("#usrPassword");u.focus()}else a.focus();i.on("submit",function(){if(s.startLoading(),$(".inputError").removeClass("inputError"),t.registerForm.$valid){var i=$(this).find("#usrPasswordConfirm"),n=$(this).find("#usrPassword"),a=t.user.usrPassword,u=t.user.usrPasswordConfirm;if(a!==u){r.addToErrorMessages("Les mots de passe saisis ne sont pas identiques");var l=$(i.siblings()[0]),c=$(n.siblings()[0]);l.removeClass("labelOnBottom"),c.removeClass("labelOnBottom"),i.addClass("inputError"),n.addClass("inputError"),n.val(""),i.val(""),$(n).focus(),s.endLoading(),t.$apply()}else{var d={usrLogin:t.user.usrLogin,usrPassword:t.user.usrPassword,usrMail:t.user.usrMail,usrFirstName:t.user.usrFirstName,usrLastName:t.user.usrLastName};e.submitRegisterForm(d,function(t,i){if(i)e.addOrUpdateUserInLocalStorage(i),r.addToSuccessMessages(t),s.endLoading(),o.url("/");else{r.addToErrorMessages(t);var n=$(this).find("#usrLogin");n.focus(),s.endLoading()}})}}else{var g=$(this).find("label[for='usrMail']");g.text("Mail");var f=!1;if(t.registerForm.usrLogin.$error.required){var v=$(this).find("#usrLogin");v.addClass("inputError"),f=!0,v.focus()}if(t.registerForm.usrPassword.$error.required){var n=$(this).find("#usrPassword");n.addClass("inputError"),f||(f=!0,n.focus())}if(t.registerForm.usrPasswordConfirm.$error.required){var i=$(this).find("#usrPasswordConfirm");i.addClass("inputError"),f||(f=!0,i.focus())}if(t.registerForm.usrMail.$error){var m=$(this).find("#usrMail");if(m.val()){var g=$(this).find("label[for='usrMail']");m.addClass("inputError"),g.append(" E-mail invalide (example@examp.ex)"),f||(f=!0,m.focus())}}s.endLoading()}})}}]),agilogClient.directive("loginFormDir",["NotificationClientService","AuthenticationClientService","$location","$rootScope",function(r,e,o,s){return function(t,i){s.root.user&&o.url("/");var n=$(i[0]),a=$(n).find("#usrLogin");if(a.val()){var u=$(n).find("#usrPassword");u.focus()}else a.focus();i.on("submit",function(){if(s.startLoading(),$(".inputError").removeClass("inputError"),t.loginForm.$valid){var i={usrLogin:$(n).find("#usrLogin").val(),usrPassword:$(n).find("#usrPassword").val()};e.submitLoginForm(i,function(t,i){if(i)e.addOrUpdateUserInLocalStorage(i),r.addToSuccessMessages(t),s.endLoading(),o.url("/");else{r.addToErrorMessages(t);var a=$(n).find("#usrLogin");a.focus(),s.endLoading()}})}else{var a=$(n).find("label[for='usrMail']");a.text("Mail");var u=!1;if(t.loginForm.usrLogin.$error.required){var l=$(n).find("#usrLogin");l.addClass("inputError"),u=!0,l.focus()}if(t.loginForm.usrPassword.$error.required){var c=$(n).find("#usrPassword");c.addClass("inputError"),u||(u=!0,c.focus())}s.endLoading()}})}}]),agilogClient.service("AuthenticationClientService",["$localStorage","$rootScope","$http",function(r,e,o){this.submitRegisterForm=function(r,e){o.post("/auth/register",{usrLogin:r.usrLogin,usrPassword:r.usrPassword,usrMail:r.usrMail,usrFirstName:r.usrFirstName,usrLastName:r.usrLastName}).then(function(r){e(r.data.message,r.data.user)})},this.submitLoginForm=function(r,e){o.post("/auth/login",{usrLogin:r.usrLogin,usrPassword:r.usrPassword}).then(function(r){e(r.data.message,r.data.user)})},this.addOrUpdateUserInLocalStorage=function(o){o&&(r.user=o,e.root.user=r.user)},this.removeUserFromLocalStorage=function(){delete r.user,delete e.root.user},this.logout=function(){return o.get("/auth/logout")}}]),agilogClient.controller("NotificationClientController",["NotificationClientService","$scope",function(r,e){e.notification={},e.notification.errorMessages=[],e.notification.successMessages=[],e.$watch(function(){return r.getErrorMessages()},function(){e.notification.errorMessages=r.getErrorMessages()},!0),e.$watch(function(){return r.getSuccessMessages()},function(){e.notification.successMessages=r.getSuccessMessages()},!0)}]),agilogClient.directive("notificationClientDir",[function(){return{restrict:"E",templateUrl:"partials/notification.html",controller:"NotificationClientController"}}]),agilogClient.directive("currentNotifDir",[function(){return function(r,e){$(e).on("click",function(){$(this).hide()})}}]),agilogClient.service("NotificationClientService",["$timeout",function(r){var e=[],o=[];this.getErrorMessages=function(){return e},this.getSuccessMessages=function(){return o},this.addToErrorMessages=function(o){if(o&&!angular.equals(o,"")){for(var s=0;s<e.length;s++)e[s][0]===o&&(r.cancel(e[s][1]),e.splice(s,1));var t=[];t.push(o);var i=r(function(){for(var r=0;r<e.length;r++)e[r][0]===o&&e.splice(r,1)},9e3);t.push(i),e.push(t)}},this.addToSuccessMessages=function(e){if(e&&!angular.equals(e,"")){for(var s=0;s<o.length;s++)o[s][0]===e&&(r.cancel(o[s][1]),o.splice(s,1));var t=[];t.push(e);var i=r(function(){for(var r=0;r<o.length;r++)o[r][0]===e&&o.splice(r,1)},9e3);t.push(i),o.push(t)}},this.removeAllErrorMessages=function(){for(var o=0;o<e.length;o++)r.cancel(e[o][1]);e=[]},this.removeAllSuccessMessages=function(){for(var e=0;e<o.length;e++)r.cancel(o[e][1]);o=[]}}]),agilogClient.directive("menuIcoDir",[function(){return function(r,e){var o=$(e[0]),s=$(o).find("#hiddenMenuItems");o.on("mouseenter",function(){o.addClass("isHover"),o.removeClass("hideDataTitle")}),o.on("mouseleave",function(){o.removeClass("isHover"),o.removeClass("hideDataTitle"),s.removeClass("active")}),o.on("click",function(){o.addClass("hideDataTitle");var r=$(s).height();r+=20,$(s).css({top:"-"+r+"px"}),s.addClass("active")})}}]),agilogClient.directive("inputText",[function(){return function(r,e){var o=$(e[0]),s=$(o.siblings()[0]);o.on("focus",function(){$(o).val()||s.addClass("moveLabelToBottom")}),o.on("focusout",function(){$(o).val()?s.addClass("labelOnBottom"):s.removeClass("labelOnBottom"),s.removeClass("moveLabelToBottom")})}}]),agilogClient.controller("RootClientController",["$rootScope",function(r){r.startLoading=function(){r.root.loading=!0,r.root.loadingQueue++},r.endLoading=function(){r.root.loadingQueue--,r.root.loadingQueue<0&&(r.root.loadingQueue=0),0==r.root.loadingQueue&&(r.root.loading=!1)}}]);
//# sourceMappingURL=app.min.js.map