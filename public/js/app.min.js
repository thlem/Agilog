"use strict";var agilogClient=angular.module("agilogClient",["ngResource","ngRoute","ngStorage"]);agilogClient.config(["$routeProvider","$httpProvider",function(o,e){o.when("/",{templateUrl:"partials/accueil.html","public":!0}).when("/login",{templateUrl:"partials/loginForm.html",controller:"AuthenticationLoginClientController","public":!0}).when("/register",{templateUrl:"partials/registerForm.html",controller:"AuthenticationRegisterClientController","public":!0}).when("/account",{templateUrl:"partials/account.html",controller:"AccountClientController"}).otherwise({redirectTo:"/"}),e.interceptors.push(["$q","$location","$localStorage","$rootScope","NotificationClientService",function(o,e,r,i,t){return{request:function(o){return o.headers=o.headers||{},r.user&&(o.headers.Authorization="Bearer "+r.user.token),o},responseError:function(n){var s=o.defer();switch(n.status){case 401:return delete r.user,delete i.root.user,t.addToErrorMessages(n.data.message),console.log(n),e.url("/"),o.reject(n);case 403:return t.addToErrorMessages(n.data.message),o.reject(n);default:return s.resolve(n),s.promise}}}}])}]),agilogClient.run(["$rootScope","$localStorage",function(o,e){o.root={},o.root.loading=null,o.root.loadingQueue=0,o.root.pageTitle="Accueil",e.user&&(o.root.user=e.user)}]),agilogClient.controller("AccountClientController",["$scope","$rootScope",function(o,e){e.root.pageTitle="Gestion de votre compte utilisateur",o.user=e.root.user}]),agilogClient.directive("usrAccountLoginDir",["NotificationClientService","AccountClientService","AuthenticationClientService","$location","$rootScope",function(o,e,r,i,t){return function(i,n){n.on("submit",function(){console.log("ok"),t.startLoading();var i=($(this).find("#usrLogin").val(),$(this).find("#usrPassword").val()),n=$(this).find("#usrPasswordConfirm").val(),s=!0;if(void 0!==i&&""!==i&&void 0!==n&&i!==n&&(s=!1,$(this).find("#usrPassword").focus(),o.addToErrorMessages("Les mots de passe saisis ne sont pas identiques")),s){var a={usrLogin:$(this).find("#usrLogin").val(),usrPassword:$(this).find("#usrPassword").val()};e.submitAccountLoginInfoForm(a,function(e,i){i?(r.addOrUpdateUserInLocalStorage(i),o.addToSuccessMessages(e)):o.addToErrorMessages(e),t.endLoading()})}})}}]),agilogClient.service("AccountClientService",["$localStorage","$rootScope","$http",function(o,e,r){this.submitAccountLoginInfoForm=function(o,e){r.post("/account/update/logininfo",{usrLogin:o.usrLogin,usrPassword:o.usrPassword}).then(function(o){e(o.data.message,o.data.user)})}}]),agilogClient.controller("AuthenticationRegisterClientController",["$scope","$location","$rootScope","AuthenticationClientService",function(o,e,r,i){o.user={}}]),agilogClient.controller("AuthenticationLoginClientController",["$scope","$location","$rootScope","AuthenticationClientService",function(o,e,r,i){o.user={}}]),agilogClient.controller("AuthenticationLogoutClientController",["$scope","$location","$rootScope","AuthenticationClientService","NotificationClientService",function(o,e,r,i,t){o.logout=function(){r.startLoading(),i.logout().then(function(o){t.addToSuccessMessages(o.data.message),i.removeUserFromLocalStorage(),r.endLoading(),e.url("/")})}}]),agilogClient.directive("registerFormDir",["NotificationClientService","AuthenticationClientService","$location","$rootScope",function(o,e,r,i){return function(t,n){i.root.user&&r.url("/");var s=$(n[0]),a=$(s).find("#usrLogin");if(a.val()){var l=$(s).find("#usrPassword");l.focus()}else a.focus();n.on("submit",function(){if(i.startLoading(),$(".inputError").removeClass("inputError"),t.registerForm.$valid){var n=$(s).find("#usrPasswordConfirm"),a=$(s).find("#usrPassword"),l=a.val(),u=n.val();if(l!==u){o.addToErrorMessages("Les mots de passe saisis ne sont pas identiques");var c=$(n.siblings()[0]),d=$(a.siblings()[0]);c.removeClass("labelOnBottom"),d.removeClass("labelOnBottom"),n.addClass("inputError"),a.addClass("inputError"),a.val(""),n.val(""),$(a).focus(),i.endLoading(),t.$apply()}else{var g={usrLogin:$(s).find("#usrLogin").val(),usrPassword:$(s).find("#usrPassword").val(),usrMail:$(s).find("#usrMail").val(),usrFirstName:$(s).find("#usrFirstName").val(),usrLastName:$(s).find("#usrLastName").val()};e.submitRegisterForm(g,function(t,n){if(n)e.addOrUpdateUserInLocalStorage(n),o.addToSuccessMessages(t),i.endLoading(),r.url("/");else{o.addToErrorMessages(t);var a=$(s).find("#usrLogin");a.focus(),i.endLoading()}})}}else{var f=$(s).find("label[for='usrMail']");f.text("Mail");var v=!1;if(t.registerForm.usrLogin.$error.required){var m=$(s).find("#usrLogin");m.addClass("inputError"),v=!0,m.focus()}if(t.registerForm.usrPassword.$error.required){var a=$(s).find("#usrPassword");a.addClass("inputError"),v||(v=!0,a.focus())}if(t.registerForm.usrPasswordConfirm.$error.required){var n=$(s).find("#usrPasswordConfirm");n.addClass("inputError"),v||(v=!0,n.focus())}if(t.registerForm.usrMail.$error){var C=$(s).find("#usrMail");if(C.val()){var f=$(s).find("label[for='usrMail']");C.addClass("inputError"),f.append(" E-mail invalide (example@examp.ex)"),v||(v=!0,C.focus())}}i.endLoading()}})}}]),agilogClient.directive("loginFormDir",["NotificationClientService","AuthenticationClientService","$location","$rootScope",function(o,e,r,i){return function(t,n){i.root.user&&r.url("/");var s=$(n[0]),a=$(s).find("#usrLogin");if(a.val()){var l=$(s).find("#usrPassword");l.focus()}else a.focus();n.on("submit",function(){if(i.startLoading(),$(".inputError").removeClass("inputError"),t.loginForm.$valid){var n={usrLogin:$(s).find("#usrLogin").val(),usrPassword:$(s).find("#usrPassword").val()};e.submitLoginForm(n,function(t,n){if(n)e.addOrUpdateUserInLocalStorage(n),o.addToSuccessMessages(t),i.endLoading(),r.url("/");else{o.addToErrorMessages(t);var a=$(s).find("#usrLogin");a.focus(),i.endLoading()}})}else{var a=$(s).find("label[for='usrMail']");a.text("Mail");var l=!1;if(t.loginForm.usrLogin.$error.required){var u=$(s).find("#usrLogin");u.addClass("inputError"),l=!0,u.focus()}if(t.loginForm.usrPassword.$error.required){var c=$(s).find("#usrPassword");c.addClass("inputError"),l||(l=!0,c.focus())}i.endLoading()}})}}]),agilogClient.service("AuthenticationClientService",["$localStorage","$rootScope","$http",function(o,e,r){this.submitRegisterForm=function(o,e){r.post("/auth/register",{usrLogin:o.usrLogin,usrPassword:o.usrPassword,usrMail:o.usrMail,usrFirstName:o.usrFirstName,usrLastName:o.usrLastName}).then(function(o){e(o.data.message,o.data.user)})},this.submitLoginForm=function(o,e){r.post("/auth/login",{usrLogin:o.usrLogin,usrPassword:o.usrPassword}).then(function(o){e(o.data.message,o.data.user)})},this.addOrUpdateUserInLocalStorage=function(r){r&&(o.user=r,e.root.user=o.user)},this.removeUserFromLocalStorage=function(){delete o.user,delete e.root.user},this.logout=function(){return r.get("/auth/logout")}}]),agilogClient.controller("NotificationClientController",["NotificationClientService","$scope",function(o,e){e.notification={},e.notification.errorMessages=[],e.notification.successMessages=[],e.$watch(function(){return o.getErrorMessages()},function(){e.notification.errorMessages=o.getErrorMessages()},!0),e.$watch(function(){return o.getSuccessMessages()},function(){e.notification.successMessages=o.getSuccessMessages()},!0)}]),agilogClient.directive("notificationClientDir",[function(){return{restrict:"E",templateUrl:"partials/notification.html",controller:"NotificationClientController"}}]),agilogClient.directive("currentNotifDir",[function(){return function(o,e){$(e).on("click",function(){$(this).hide()})}}]),agilogClient.service("NotificationClientService",["$timeout",function(o){var e=[],r=[];this.getErrorMessages=function(){return e},this.getSuccessMessages=function(){return r},this.addToErrorMessages=function(r){if(r&&!angular.equals(r,"")){for(var i=0;i<e.length;i++)e[i][0]===r&&(o.cancel(e[i][1]),e.splice(i,1));var t=[];t.push(r);var n=o(function(){for(var o=0;o<e.length;o++)e[o][0]===r&&e.splice(o,1)},9e3);t.push(n),e.push(t)}},this.addToSuccessMessages=function(e){if(e&&!angular.equals(e,"")){for(var i=0;i<r.length;i++)r[i][0]===e&&(o.cancel(r[i][1]),r.splice(i,1));var t=[];t.push(e);var n=o(function(){for(var o=0;o<r.length;o++)r[o][0]===e&&r.splice(o,1)},9e3);t.push(n),r.push(t)}},this.removeAllErrorMessages=function(){for(var r=0;r<e.length;r++)o.cancel(e[r][1]);e=[]},this.removeAllSuccessMessages=function(){for(var e=0;e<r.length;e++)o.cancel(r[e][1]);r=[]}}]),agilogClient.directive("menuIcoDir",[function(){return function(o,e){var r=$(e[0]),i=$(r).find("#hiddenMenuItems");r.on("mouseenter",function(){r.addClass("isHover"),r.removeClass("hideDataTitle")}),r.on("mouseleave",function(){r.removeClass("isHover"),r.removeClass("hideDataTitle"),i.removeClass("active")}),r.on("click",function(){r.addClass("hideDataTitle");var o=$(i).height();o+=20,$(i).css({top:"-"+o+"px"}),i.addClass("active")})}}]),agilogClient.directive("inputText",[function(){return function(o,e){var r=$(e[0]),i=$(r.siblings()[0]);r.on("focus",function(){$(r).val()||i.addClass("moveLabelToBottom")}),r.on("focusout",function(){$(r).val()?i.addClass("labelOnBottom"):i.removeClass("labelOnBottom"),i.removeClass("moveLabelToBottom")})}}]),agilogClient.controller("RootClientController",["$rootScope",function(o){o.startLoading=function(){o.root.loading=!0,o.root.loadingQueue++},o.endLoading=function(){o.root.loadingQueue--,o.root.loadingQueue<0&&(o.root.loadingQueue=0),0==o.root.loadingQueue&&(o.root.loading=!1)}}]);
//# sourceMappingURL=app.min.js.map